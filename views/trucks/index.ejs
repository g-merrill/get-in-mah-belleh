<%- include('../partials/headerhtml') %>
<div class="logocontainer">
  <i class="logo fas fa-hamburger fa-4x">.</i>
  <i class="logo fas fa-truck fa-4x">.</i>
  <i class="logo fas fa-smile fa-4x">!</i>
</div>
<h1>Find the best food trucks in San Francisco.</h1>
<!-- non-functional -->
<form action="/trucks" method="GET">
  <i class="fas fa-search"></i>
  <input type="search" name="searchbar" id="searchbar" placeholder="Search for food trucks, neighborhood, or cuisines...">
  <input type="submit" value="Go!">
</form>
<select name="sortvariable" id="sortselect">
  <option value="sortby">SORT BY</option>
  <option value="1">Name (A-Z)</option>
  <option value="2">Name (Z-A)</option>
  <option value="3">Star rating</option>
  <option value="4">Number of reviews</option>
  <option value="5">Recently reviewed</option>
</select>
<select name="filtervariable" id="filterselect">
  <option value="filter">FILTER</option>
  <option value="a">Food type</option>
  <option value="b">Star rating</option>
</select>
<!-- non-functional -->
<% if (trucks.length) { %>
<ul>
  <% trucks.forEach((truck, idx) => { %>
  <li class="truck-card-container">
    <p class="truck-card-header"><%= truck.applicant.toUpperCase(); %></p>
    <!-- <p><%= truck.fooditems %></p> -->
    <% if (truck.reviews.length) { %>        
      <% for (let i = 0; i !== avgRatings[idx]; i++) { %>
    <span>&#9733</span>
      <% } %>
    <!-- how do I make this preview text? -->
    <div class="truck-card-revcontainer">
      <p class="truck-card-revtext"><%= truck.reviews[truck.reviews.length - 1].content; %></p>
      <a class="truck-card-showlink" href="/trucks/<%= truck.id %>">read more</a>
    </div>
    <!-- how do I make this preview text? -->
    <% } else { %>
      <span>&#9734</span>
      <span>&#9734</span>
      <span>&#9734</span>
      <span>&#9734</span>
      <span>&#9734</span>
    <div class="truck-card-revcontainer">
      <p class="truck-card-revtext">No review submitted for this truck yet!</p>
      <a class="truck-card-showlink" href="/trucks/<%= truck.id %>">read more</a>
    </div>  
    <% } %>
    <a href="/users/profile/trucks/<%= truck.id %>/reviews/new"><i class="fas fa-pen"></i> Write a review</a>
    <% if (!user) { %>
    <form action="/users/profile/trucks/favorites" method="GET">
      <p><button class="heartcontainer" type="submit"><i class="hoverhearts far fa-heart"></i><i class="hoverhearts far fa-heart"></i></button> Save to favorites</p>
    </form>
    <% } else { %>
      <% if (!user.favTrucks.some(favTruck => favTruck.toString() === truck.id)) { %>
    <!-- if not in user's favTrucks array, enable add to favorites functionality with class of 'unhearted' -->
    <form action="/trucks/<%= truck.id %>/favorites/index" method="POST">
      <p><button class="heartcontainer" type="submit"><i class="hoverhearts far fa-heart"></i><i class="hoverhearts fas fa-heart"></i></button> Save to favorites</p>
    </form>
      <% } else { %>
    <!-- else enable delete from trucks functionality with class of 'hearted' -->
    <form action="/trucks/<%= truck.id %>/favorites/index?_method=DELETE" method="POST">
      <p><button type="submit"><i class="fas fa-heart"></i></button> Saved to favorites</p>
    </form>
      <% } %>
    <% } %>
  </li>
  <% }); %>
</ul>
<% } %>
<%- include('../partials/footerhtml') %>
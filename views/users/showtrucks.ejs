<%- include('../partials/headerhtml') %>
<% if (!user) { %>
<p>Not Logged In</p>
<% } else { %>
<nav>
    <div>
        <a href="/users/profile/trucks/submitted">Submitted Trucks</a>
    </div>
    <div>
        <a href="/users/profile/reviews/submitted">Submitted Reviews</a>
    </div>
</nav>
<h1>Your truckSFinder trucks</h1>
    <% if (!trucks.length) { %>
<p>You have not submitted any food trucks yet!</p>
    <% } else { %>
<ul>
        <% trucks.forEach((truck, idx) => { %>
    <form action="/trucks/<%= truck.id %>?_method=DELETE" method="POST">
        <input type="submit" value="X">
    </form>
    <li class="truck-card-container">
        <p class="truck-card-header"><%= truck.applicant.toUpperCase(); %></p>
        <!-- <p><%= truck.fooditems %></p> -->
            <% if (truck.reviews.length) { %>        
                <% for (let i = 0; i !== avgRatings[idx]; i++) { %>
        <span>&#9733</span>
                <% } %>
        <!-- how do I make this preview text? -->
        <div class="truck-card-revcontainer">
            <p class="truck-card-revtext"><%= truck.reviews[truck.reviews.length - 1].content; %></p>
        <a class="truck-card-showlink" href="/trucks/<%= truck.id %>">read more</a>
        </div>
        <!-- how do I make this preview text? -->
            <% } else { %>
        <span>&#9734</span>
        <span>&#9734</span>
        <span>&#9734</span>
        <span>&#9734</span>
        <span>&#9734</span>
        <div class="truck-card-revcontainer">
            <p class="truck-card-revtext">No review submitted for this truck yet!</p>
        <a class="truck-card-showlink" href="/trucks/<%= truck.id %>">read more</a>
        </div>  
            <% } %>
        <a href="/users/profile/trucks/<%= truck.id %>/reviews/new"><i class="fas fa-pen"></i> Write a review</a>
        <% if (!user) { %>
        <form action="/users/profile/trucks/favorites" method="GET">
            <p><button class="heartcontainer" type="submit"><i class="hoverhearts far fa-heart"></i><i class="hoverhearts far fa-heart"></i></button> Save to favorites</p>
        </form>
        <% } else { %>
            <% if (!user.favTrucks.some(favTruck => favTruck.toString() === truck.id)) { %>
        <!-- if not in user's favTrucks array, enable add to favorites functionality with class of 'unhearted' -->
        <form action="/trucks/<%= truck.id %>/favorites/submitted" method="POST">
            <p><button class="heartcontainer" type="submit"><i class="hoverhearts far fa-heart"></i><i class="hoverhearts fas fa-heart"></i></button> Save to favorites</p>
        </form>
            <% } else { %>
        <!-- else enable delete from trucks functionality with class of 'hearted' -->
        <form action="/trucks/<%= truck.id %>/favorites/submitted?_method=DELETE" method="POST">
            <p><button type="submit"><i class="fas fa-heart"></i></button> Saved to favorites</p>
        </form>
            <% } %>
        <% } %>
    </li>
    <a href="/users/profile/trucks/<%= truck.id %>/edit">Edit Food Truck Details</a>
        <% }); %>
</ul>
    <% } %>
<% } %>
<%- include('../partials/footerhtml') %>